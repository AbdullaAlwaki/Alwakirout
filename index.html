<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Delivery</title>
  
  <!-- مكتبات Leaflet -->
  <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.min.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    :root {
      --primary: #3B82F6;
      --secondary: #10B981;
      --dark: #1F2937;
      --light: #F3F4F6;
      --danger: #EF4444;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      background: var(--dark);
      color: var(--light);
      line-height: 1.6;
    }

    /* شريط العناوين العلوي */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: #1E293B;
      display: flex;
      align-items: center;
      padding: 0 20px;
      z-index: 1000;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .navbar-brand {
      color: var(--light);
      font-weight: 600;
      font-size: 1.2rem;
    }

    .navbar-status {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9rem;
    }

    /* الخريطة */
    #map {
      height: 100vh;
      margin-top: 60px;
    }

    /* لوحة التوجيه */
    .route-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--dark);
      border-top: 1px solid #4B5563;
      padding: 20px;
      transform: translateY(100%);
      transition: 0.3s;
      z-index: 1000;
    }

    .route-panel.open {
      transform: translateY(0);
    }

    .route-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .route-title {
      color: var(--light);
      font-size: 1.2rem;
      font-weight: 600;
    }

    .close-btn {
      background: none;
      border: none;
      color: #9CA3AF;
      font-size: 1.2rem;
      cursor: pointer;
    }

    /* قائمة النقاط */
    .points-list {
      max-height: 60vh;
      overflow-y: auto;
      margin-bottom: 20px;
    }

    .point-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px 0;
      border-bottom: 1px solid #4B5563;
    }

    .point-item:last-child {
      border-bottom: none;
    }

    .point-icon {
      color: var(--primary);
      font-size: 1.2rem;
    }

    .point-details {
      flex: 1;
    }

    .point-name {
      color: var(--light);
      font-weight: 500;
    }

    .point-time {
      color: #9CA3AF;
      font-size: 0.9rem;
    }

    .point-actions {
      display: flex;
      gap: 10px;
      color: #9CA3AF;
    }

    /* زر بدء التنقل */
    .start-btn {
      width: 100%;
      padding: 15px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }

    .start-btn:hover {
      background: #2563EB;
    }

    /* مؤشر التحميل */
    .loader {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 20px;
      border-radius: 8px;
      display: none;
    }

    /* تصميم متجاوب */
    @media (max-width: 600px) {
      .navbar-brand {
        font-size: 1.1rem;
      }
      
      .status-item {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- شريط العناوين -->
  <nav class="navbar">
    <div class="navbar-brand">Smart Delivery</div>
    <div class="navbar-status">
      <div class="status-item">
        <i class="fas fa-wifi"></i> <span>4G</span>
      </div>
      <div class="status-item">
        <i class="fas fa-battery-three-quarters"></i> <span>78%</span>
      </div>
      <div class="status-item">
        <i class="fas fa-clock"></i> <span>12:34</span>
      </div>
    </div>
  </nav>

  <!-- الخريطة -->
  <div id="map"></div>

  <!-- لوحة التوجيه -->
  <div class="route-panel" id="routePanel">
    <div class="route-header">
      <h3 class="route-title">الاتجاهات</h3>
      <button class="close-btn" onclick="togglePanel()">&times;</button>
    </div>
    
    <div class="points-list" id="pointsList">
      <!-- النقاط ستظهر هنا ديناميكياً -->
    </div>
    
    <button class="start-btn" onclick="startNavigation()">بدء التنقل</button>
  </div>

  <!-- مؤشر التحميل -->
  <div class="loader" id="loader">جارِ التحميل...</div>

  <script>
    // تهيئة الخريطة
    const map = L.map('map').setView([24.774265, 46.738586], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);

    // تهيئة العناصر
    const routePanel = document.getElementById('routePanel');
    const pointsList = document.getElementById('pointsList');
    const loader = document.getElementById('loader');

    // بيانات العناوين
    let currentRoute = null;
    let waypoints = [];

    // إظهار/إخفاء اللوحة
    function togglePanel() {
      routePanel.classList.toggle('open');
    }

    // بدء التنقل
    function startNavigation() {
      if(waypoints.length < 2) {
        return Swal.fire('خطأ', 'يجب تحديد نقطة بداية ونقطة نهاية على الأقل', 'error');
      }
      
      if(currentRoute) map.removeControl(currentRoute);
      
      currentRoute = L.Routing.control({
        waypoints: waypoints,
        lineOptions: {
          styles: [{color: '#38bdf8', weight: 6}]
        },
        routeWhileDragging: false,
        createMarker: (i, wp) => {
          const icon = i === 0 ? 'fas fa-home' : i === waypoints.length-1 ? 'fas fa-flag' : 'fas fa-circle';
          return L.marker(wp.latLng, {
            icon: L.divIcon({
              className: 'routing-icon',
              html: `<i class="${icon}"></i>`,
              iconSize: [30, 30]
            })
          });
        }
      }).addTo(map);
      
      currentRoute.on('routesfound', (e) => {
        const route = e.routes[0];
        const distance = (route.summary.totalDistance / 1000).toFixed(1);
        const time = Math.round(route.summary.totalTime / 60);
        Swal.fire({
          title: 'تفاصيل المسار',
          html: `
            <div>المسافة: ${distance} كم</div>
            <div>الوقت: ${time} دقائق</div>
          `,
          icon: 'info'
        });
      });
    }

    // إضافة نقطة جديدة
    function addWaypoint(latlng, name, type) {
      waypoints.push(latlng);
      const point = document.createElement('div');
      point.className = 'point-item';
      point.innerHTML = `
        <i class="point-icon ${type === 'start' ? 'fas fa-home' : type === 'end' ? 'fas fa-flag' : 'fas fa-circle'}"></i>
        <div class="point-details">
          <div class="point-name">${name}</div>
          <div class="point-time">${type === 'start' ? 'الانطلاق' : 'الوصول'}</div>
        </div>
        <div class="point-actions">
          <i class="fas fa-pencil-alt" onclick="editPoint(${waypoints.length-1})"></i>
          <i class="fas fa-trash" onclick="deletePoint(${waypoints.length-1})"></i>
        </div>
      `;
      pointsList.appendChild(point);
    }

    // تعديل نقطة
    function editPoint(index) {
      const newName = prompt('أدخل الاسم الجديد:');
      if(newName) {
        pointsList.children[index].querySelector('.point-name').textContent = newName;
      }
    }

    // حذف نقطة
    function deletePoint(index) {
      Swal.fire({
        title: 'تأكيد الحذف',
        text: 'هل أنت متأكد من حذف هذه النقطة؟',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'نعم',
        cancelButtonText: 'إلغاء'
      }).then((result) => {
        if(result.isConfirmed) {
          waypoints.splice(index, 1);
          pointsList.removeChild(pointsList.children[index]);
        }
      });
    }

    // مثال على إضافة نقاط
    function exampleRoute() {
      showLoader();
      setTimeout(() => {
        addWaypoint(L.latLng(24.774265, 46.738586), 'موقعي الحالي', 'start');
        addWaypoint(L.latLng(24.7136, 46.6753), 'الملعب الأولمبي', 'end');
        hideLoader();
      }, 1000);
    }

    // عرض/إخفاء مؤشر التحميل
    function showLoader() {
      loader.style.display = 'block';
    }
    function hideLoader() {
      loader.style.display = 'none';
    }

    // التهيئة الأولية
    exampleRoute();
  </script>
</body>
</html>
